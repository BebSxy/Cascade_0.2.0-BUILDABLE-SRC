/*
 * Decompiled with CFR 0.151.
 * 
 * Could not load the following classes:
 *  net.minecraft.entity.Entity
 *  net.minecraft.network.Packet
 *  net.minecraft.network.play.client.CPacketEntityAction
 *  net.minecraft.network.play.client.CPacketEntityAction$Action
 *  net.minecraft.network.play.client.CPacketPlayer
 *  net.minecraft.network.play.client.CPacketPlayer$Position
 *  net.minecraft.network.play.client.CPacketPlayer$PositionRotation
 *  net.minecraftforge.fml.common.eventhandler.SubscribeEvent
 */
package cascade.features.modules.exploit;

import cascade.Cascade;
import cascade.event.events.MoveEvent;
import cascade.event.events.PacketEvent;
import cascade.features.modules.Module;
import cascade.features.setting.Setting;
import cascade.mixin.mixins.accessor.ITimer;
import cascade.util.entity.EntityUtil;
import cascade.util.player.MovementUtil;
import net.minecraft.entity.Entity;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class FastMotion
extends Module {
    Setting<Boolean> useTimer = this.register(new Setting<Boolean>("UseTimer", true));
    Setting<Boolean> noLag = this.register(new Setting<Boolean>("NoLag", true));
    Setting<Float> wFactor = this.register(new Setting<Float>("WFactor", Float.valueOf(64.0f), Float.valueOf(0.1f), Float.valueOf(110.0f)));
    Setting<Float> lFactor = this.register(new Setting<Float>("LFactor", Float.valueOf(105.0f), Float.valueOf(0.1f), Float.valueOf(110.0f)));
    boolean flag;

    public FastMotion() {
        super("FastMotion", Module.Category.EXPLOIT, "Longjump for liquids");
    }

    @Override
    public void onEnable() {
        if (FastMotion.mc.thePlayer != null && EntityUtil.isInLiquid()) {
            MovementUtil.setMotion(0.0, FastMotion.mc.thePlayer.motionY, 0.0);
        }
        this.flag = false;
    }

    @Override
    public void onDisable() {
        if (this.useTimer.getValue().booleanValue() && ((ITimer)FastMotion.mc.timer).getTickLength() != 50.0f) {
            Cascade.timerManager.reset();
        }
    }

    @SubscribeEvent
    public void onMove(MoveEvent e) {
        if (!MovementUtil.isMoving() || this.isDisabled()) {
            return;
        }
        if (this.noLag.getValue().booleanValue() && Cascade.packetManager.caughtPlayerPosLook()) {
            return;
        }
        if (EntityUtil.isInLiquid()) {
            if (this.useTimer.getValue().booleanValue()) {
                Cascade.timerManager.set(1.0888f);
            }
            mc.getNetHandler().addToSendQueue((Packet)new CPacketEntityAction((Entity)FastMotion.mc.thePlayer, CPacketEntityAction.Action.START_SPRINTING));
            FastMotion.mc.thePlayer.setSprinting(true);
            if (!FastMotion.mc.gameSettings.keyBindSneak.getIsKeyPressed() && FastMotion.mc.gameSettings.keyBindJump.getIsKeyPressed()) {
                e.setY(0.11);
                this.flag = false;
            } else if (FastMotion.mc.gameSettings.keyBindSneak.getIsKeyPressed() && !FastMotion.mc.gameSettings.keyBindJump.getIsKeyPressed()) {
                FastMotion.mc.thePlayer.setSneaking(false);
                this.flag = false;
            } else {
                e.setY(0.0);
                this.flag = !this.flag;
            }
            e.setY(0.0);
            e.setX(e.getX() * (double)(FastMotion.mc.thePlayer.isInLava() ? this.lFactor.getValue() : this.wFactor.getValue()).floatValue());
            e.setZ(e.getZ() * (double)(FastMotion.mc.thePlayer.isInLava() ? this.lFactor.getValue() : this.wFactor.getValue()).floatValue());
        }
    }

    @SubscribeEvent
    public void onPacketSend(PacketEvent.Send e) {
        if (this.isDisabled() || FastMotion.fullNullCheck() || !EntityUtil.isInLiquid()) {
            return;
        }
        if ((e.getPacket() instanceof CPacketPlayer.Position || e.getPacket() instanceof CPacketPlayer.PositionRotation) && this.flag) {
            ((CPacketPlayer)e.getPacket()).y -= 0.005;
        }
    }
}

